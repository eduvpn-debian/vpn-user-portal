<!DOCTYPE html>

<html lang="en">
{% include 'head.twig' %}
<body>
    {% include 'header.twig' %}

    <ul class="menu">
      <li><a href="new">{% trans "New" %}</a></li>
      <li><a href="configurations">{% trans "Configurations" %}</a></li>
      <li class="active"><a href="account">{% trans "Account" %}</a></li>
      <li><a href="documentation">{% trans "Documentation" %}</a></li>
    </ul>

    {% if hasTotpSecret %}
        <p class="success">
            {% trans "You are already enrolled for TOTP." %}
        </p>
    {% else %}
        <p>
            {% trans "Here you can enroll for two-factor authentication (2FA) using a Time-based One-time Password (TOTP)." %}
            {% trans %}See the <a href="documentation">documentation</a> for more information on 2FA and a list of applications to use.{% endtrans %}
        </p>

        <p class="warning">
            {% trans %}Only an administrator can remove 2FA from your account!{% endtrans %}
        </p>
            
        <dl>
            <dt>{% trans "Secret" %}</dt>
            <dd><code>{{ totpSecret }}</code></dd>
            <dt>QR</dt>
            <dd><img src="totp/qr-code?totp_secret={{ totpSecret }}"></dd>
        </dl>

        <p>
            {% trans %}Scan the QR code using your 2FA application, or import the secret manually. Confirm the successful configuration by entering a 6 digit OTP generated by the application below. {% endtrans %}
        </p>

        {% if error_code is defined %}
            {% if 'invalid_otp_code' == error_code %}
                <p class="error">{% trans "The OTP key you entered does not match the expected value for this OTP secret." %}</p>
            {% else %}
                <p class="error">{{ error_code }}</p>
            {% endif %}
        {% endif %}

        <form method="post" action="totp">
            <fieldset>
                <label for="otp_key">OTP</label>
                <input type="text" id="totp_key" inputmode="numeric" name="totp_key" autocomplete="off" maxlength="6" required pattern="[0-9]{6}" autofocus>
                <input type="hidden" name="totp_secret" value="{{ totpSecret }}"> 
            </fieldset>
            <fieldset>
                <button>{% trans "Verify" %}</button>
            </fieldset>
        </form>
    {% endif %}
    
    {% include 'footer.twig' %}

</body>
</html>
